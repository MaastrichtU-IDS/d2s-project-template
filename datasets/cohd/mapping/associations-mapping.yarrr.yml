### Using Split function with YARRRML: https://rml.io/yarrrml/matey/
prefixes:
  grel: "http://users.ugent.be/~bjdmeest/function/grel.ttl#"
  xsd: "http://www.w3.org/2001/XMLSchema#"
  rdfs: "http://www.w3.org/2000/01/rdf-schema#"
  bl: "https://w3id.org/biolink/vocab/"
  cohd: "https://w3id.org/trek/cohd/"
  omop: "http://api.ohdsi.org/WebAPI/vocabulary/concept/"

# dataset_id,concept_id_1,concept_id_2,concept_count,concept_prevalence,chi_square_t,chi_square_p,expected_count,ln_ratio,rel_freq_1,rel_freq_2
# 1,8507,955372,6,3.351148e-06,6.983689e-01,4.033323e-01,4.631562e+00,2.588652e-01,7.959006e-06,5.454545e-01
# 1,8507,985786,7,3.909673e-06,4.141921e-01,5.198494e-01,8.421023e+00,-1.848211e-01,9.285507e-06,3.500000e-01

mappings:
  associations:
    sources:
      - ['cohd.csv~csv']
      # - ['/mnt/workspace/input/cohd/paired_concept_counts_associations.csv~csv']
    s: cohd:association/$(concept_id_1)_$(concept_id_2)
    # s: cohd:association/$(dataset_id)_$(concept_id_1)_$(concept_id_2)
    g: https://w3id.org/trek/graph/cohd
    po:
      - [a, bl:Association]
      - p: bl:id
        o: cohd:association/$(concept_id_1)_$(concept_id_2)~iri
        # o: cohd:association/$(dataset_id)_$(concept_id_1)_$(concept_id_2)~iri
      - p: bl:subject
        o: omop:$(concept_id_1)~iri
      - p: bl:relation
        o: bl:correlated_with~iri
      - p: bl:object
        o: omop:$(concept_id_2)~iri
      # - p: bl:provided_by
      #   o: cohd:provider/dataset/$(dataset_id)~iri
      - p: bl:has_evidence
        o: cohd:evidence/$(dataset_id)_$(concept_id_1)_$(concept_id_2)/chi_square~iri
      # - p: bl:has_evidence
      #   o: cohd:evidence/$(dataset_id)_$(concept_id_1)_$(concept_id_2)/concept_count~iri

  chi_square_evidence:
    sources:
      - ['cohd.csv~csv']
      # - ['/mnt/workspace/input/cohd/paired_concept_counts_associations.csv~csv']
    s: cohd:evidence/$(dataset_id)_$(concept_id_1)_$(concept_id_2)/chi_square
    g: https://w3id.org/trek/graph/cohd
    po:
      - [a, bl:EvidenceType]
      - p: bl:id
        o: cohd:evidence/$(dataset_id)_$(concept_id_1)_$(concept_id_2)/chi_square~iri
      - p: bl:name
        o: Chi squared statistic for concepts $(dataset_id) and $(concept_id_1) in COHD dataset $(concept_id_2)
      - p: bl:chi_squared_statistic
        o: 
          value: $(chi_square_t)
          datatype: xsd:double
      - p: bl:p_value
        o: 
          value: $(chi_square_p)
          datatype: xsd:double
      - p: bl:provided_by
        o: cohd:provider/dataset/$(dataset_id)~iri
        
        
        
        
        
        # function: grel:string_split
        #     parameters:
        #         - [grel:p_string_sep, "\|"]
        #         - [grel:valueParameter, $(neighbours)]
        #     language: en

### Using to lower case (working)

# prefixes:
#   grel: "http://users.ugent.be/~bjdmeest/function/grel.ttl#"
#   rdfs: "http://www.w3.org/2000/01/rdf-schema#"
#   gn: "http://www.geonames.org/ontology#"

# mappings:
#   lowerneighbours:
#     sources:
#       - ['source_1.csv~csv']
#     s: http://www.geonames.org/ontology#$(ISO)
#     po:
#       - [a, gn:Country]
#       - [rdfs:label, $(neighbours)]
#       - p: gn:neighbours
#         o:
#             function: grel:toLowerCase
#             parameters:
#                 - [grel:valueParameter, $(neighbours)]
#             language: en